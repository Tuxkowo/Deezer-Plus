var wikipedia = {	locale: null,	lastArtist: null,	lastArtistPopup: null,	wikiArticle: document.createElement("p").innerHTML = 'Lancez la lecture pour afficher l\'article Wikipédia correspondant à cet artiste.',    toAbs: function(link, host) {		var lparts = link.split('/');		if (/http:|https:|ftp:/.test(lparts[0])) {			// already abs, return			return link;		}		link = link.replace(new RegExp(chrome.extension.getURL("").replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")),"");		return host + link;	},	init: function(source) {		this.locale = localStorage.getItem('wikipediaLocale');				if(source == 'options') {				document.getElementById("WikipediaLocale").value = localStorage.getItem('wikipediaLocale');			this.changeLocale();		}	},	changeLocale: function() {		this.locale = document.getElementById("WikipediaLocale").value;		localStorage.setItem("wikipediaLocale", this.locale);		document.getElementById("wikiTestLink").textContent = 'http://' + this.locale + ".wikipedia.org/wiki/The_Beatles";		document.getElementById("wikiTestLink").href = 'http://' + this.locale + ".wikipedia.org/wiki/The_Beatles";		chrome.extension.getBackgroundPage().wikipedia.lastArtist = '';		chrome.extension.getBackgroundPage().wikipedia.pushInformations();			},	pushInformations: function() {		if(this.lastArtist != songData.songInf.currentArtist) {			this.lastArtist = songData.songInf.currentArtist;			var xhr = new XMLHttpRequest(); 			  xhr.onreadystatechange = function() { 				 if(xhr.readyState == 4) {					if(xhr.status == 200) { 						 wikipedia.wikiArticle = new DOMParser().parseFromString(xhr.responseText, "text/xml");						 wikipedia.wikiArticle = wikipedia.wikiArticle.getElementById('bodyContent');						}						 else							wikipedia.wikiArticle = document.createElement("p").innerHTML = "Aucun article pour cet artiste n'a été trouvé.";						 					}				};						xhr.open("GET", 'http://' + wikipedia.locale + '.wikipedia.org/wiki/' + encodeURIComponent(songData.songInf.currentArtist) , true);			xhr.send(); 		};	},	refreshPopUp: function() {		chrome.extension.sendRequest({name: "getInfos", resource:"wikipedia"}, function(response) {			if(this.lastArtist != response.currentArtist) {				wikipedia.lastArtist = response.currentArtist;				if(typeof response.content !== "undefined") {					document.getElementById('wikipedia').innerHTML = response.content;					// Suppression liens édition					var links = document.getElementById('wikipedia').getElementsByTagName('span');					for(var i = 0; i < links.length ; i++) {						if(links[i].className == "editsection")							links[i].innerHTML = ""; 					}										// Suppression des notes						var links = document.getElementById('wikipedia').getElementsByTagName('sup');					for(var i = 0; i < links.length ; i++) {						if(links[i].className == "reference")							links[i].innerHTML = ""; 					}										// Liens relatifs > Absolus					var links = document.getElementById('wikipedia').getElementsByTagName('a');					for(var i = 0; i < links.length ; i++) {						links[i].href = wikipedia.toAbs(links[i].href, 'http://' + wikipedia.locale + ".wikipedia.org/");						links[i].target = "_blank";					}					document.getElementById('wikipedia').removeChild(document.getElementById('catlinks')); 					document.getElementById('wikipedia').removeChild(document.getElementById('jump-to-nav')); 					document.getElementById('wikipedia').removeChild(document.getElementById('toc')); 				} else {					document.getElementById('wikipedia').innerHTML = "L'article de l'artiste recherché est introuvable.";				}			}		});			},	unload: function() {		this.locale = null;		this.lastArtist = null;		this.lastArtistPopup = null;		this.wikiArticle = document.createElement("p").innerHTML = 'Lancez la lecture pour afficher l\'article Wikipédia correspondant à cet artiste.';	}}