var wikipedia = {	locale: null,	lastArtist: null,	lastArtistPopup: null,	wikiArticle: document.createElement("p").innerHTML = 'Lancez la lecture pour afficher l\'article Wikipédia correspondant à cet artiste.',    toAbs: function(link, host) {		var lparts = link.split('/');		if (/http:|https:|ftp:/.test(lparts[0])) {			// already abs, return			return link;		}		link = link.replace(new RegExp(chrome.extension.getURL("").replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")),"");		return host + link;	},	init: function(source) {		this.locale = localStorage.getItem('wikipediaLocale');				if(source == 'options') {				document.getElementById("WikipediaLocale").value = localStorage.getItem('wikipediaLocale');			this.changeLocale();		}	},	changeLocale: function() {		this.locale = document.getElementById("WikipediaLocale").value;		localStorage.setItem("wikipediaLocale", this.locale);		document.getElementById("wikiTestLink").textContent = 'http://' + this.locale + ".wikipedia.org/wiki/The_Beatles";		document.getElementById("wikiTestLink").href = 'http://' + this.locale + ".wikipedia.org/wiki/The_Beatles";			},	pushInformations: function() {		if(wikipedia.lastArtist != songData.songInf.currentArtist) {			wikipedia.lastArtist = songData.songInf.currentArtist;			wikipedia.wikiArticle = true;			var xhr = new XMLHttpRequest(); 			  xhr.onreadystatechange = function() { 				 if(xhr.readyState == 4) {					if(xhr.status == 200) { 						 wikipedia.wikiArticle = new DOMParser().parseFromString(xhr.responseText, "text/xml");						 wikipedia.wikiArticle = wikipedia.wikiArticle.getElementById('bodyContent').innerHTML;						}						 else							wikipedia.wikiArticle = false;						 					}				};						xhr.open("GET", 'http://' + wikipedia.locale + '.wikipedia.org/wiki/' + encodeURIComponent(songData.songInf.currentArtist) , true);			xhr.send(); 		};	},	refreshPopUp: function() {		chrome.extension.sendRequest({name: "getInfos", resource:"wikipedia"}, function(response) {			if(wikipedia.lastArtist != response.currentArtist) {				if(typeof response.content == "boolean") {					// L'article n'est pas disponible					if(response.content == true) {						// Recherche en cours						document.getElementById('wikipedia').innerHTML = "L'article Wikipédia de " + response.currentArtist + " est en cours de recherche...";						window.setTimeout(wikipedia.refreshPopUp,100);					} else {						// Article non trouvé						document.getElementById('wikipedia').innerHTML = "L'article Wikipédia de " + response.currentArtist + " est introuvable.";						wikipedia.lastArtist = response.currentArtist;										}				} else if(typeof response.content == "string") {					// Article trouvé, tout est OK (ou pas)					document.getElementById('wikipedia').innerHTML = response.content;					// Suppression liens édition					var links = document.getElementById('wikipedia').getElementsByTagName('span');					for(var i = 0; i < links.length ; i++) {						if(links[i].className == "editsection")							links[i].innerHTML = ""; 					}										// Suppression des notes						var links = document.getElementById('wikipedia').getElementsByTagName('sup');					for(var i = 0; i < links.length ; i++) {						if(links[i].className == "reference")							links[i].innerHTML = ""; 					}										// Liens relatifs > Absolus					var links = document.getElementById('wikipedia').getElementsByTagName('a');					for(var i = 0; i < links.length ; i++) {						links[i].href = wikipedia.toAbs(links[i].href, 'http://' + wikipedia.locale + ".wikipedia.org/");						links[i].target = "_blank";					}					document.getElementById('wikipedia').removeChild(document.getElementById('catlinks')); 					document.getElementById('wikipedia').removeChild(document.getElementById('jump-to-nav')); 					document.getElementById('wikipedia').removeChild(document.getElementById('toc'));					wikipedia.lastArtist = response.currentArtist;					wikipedia.popLastAnswer = true;								}			}/**/ 		});			},	unload: function() {		this.locale = null;		this.lastArtist = null;		this.lastArtistPopup = null;		this.wikiArticle = document.createElement("p").innerHTML = 'Lancez la lecture pour afficher l\'article Wikipédia correspondant à cet artiste.';	}}