var popup = {	lastArtist: null,	lastSong: null,	paused: false,	playPauseChanged: 0,	action: null,	refreshPopUp: function() {		chrome.extension.sendRequest({name: "getInfos", resource:"popup"}, function(response) {			if(popup.lastArtist != response.currentArtist 				|| popup.lastSong != response.currentSong ) {				wikipedia.refreshPopUp();				lyrics.refreshPopUp();				deezerAPI.refreshPopUp();				lastfm.refreshPopUp();				console.log("Refresh pop : "+ response.currentArtist + " - " + response.currentSong);				popup.lastArtist = response.currentArtist;				popup.lastSong = response.currentSong;				document.getElementById('artist').innerHTML = popup.lastArtist;				document.getElementById('song').innerHTML = popup.lastSong;			};			popup.paused = response.paused;									// TODO : Refaire le code, il bouffe trop de ressources			// Permet de retarder le changement.			if(popup.playPauseChanged == 0) {				if(popup.paused == true &&					document.getElementById("controlPause").style.display != 'none') {					 document.getElementById("controlPause").style.display = 'none';					 document.getElementById("controlPlay").style.display = '';				} else if(document.getElementById("controlPlay").style.display != 'none'){					document.getElementById("controlPause").style.display = '';					 document.getElementById("controlPlay").style.display = 'none';				}			} else {				popup.playPauseChanged--;			}		});	},	unload: function () {		popup.lastArtist = null;		popup.lastSong = null;		document.getElementById('artist').innerHTML = "";		document.getElementById('song').innerHTML = "";		document.getElementById('wikipedia').innerHTML = 'Wikipédia ne peut être chargée car aucun onglet avec <a href="http://www.deezer.com/" target="_blank">Deezer</a> n\'est ouvert.';		document.getElementById('lyrics').innerHTML = 'Les paroles ne peuvent être chargées car aucun onglet avec <a href="http://www.deezer.com/" target="_blank">Deezer</a> n\'est ouvert.';	},	switchView: function(view) {		var views = document.getElementById("multipleview").childNodes;		for(var i = 0; i < views.length; i++ ) {			if(views[i].nodeType == 1) {				if(views[i].nodeName == "DIV" && views[i].id != view) {					views[i].style.display = 'none';				} else {					views[i].style.display = 'block';				}			}		}		var views = document.getElementById("popup_nav").childNodes;		for(var i = 0; i < views.length; i++ ) {			if(views[i].nodeType == 1) {				if(views[i].nodeName == "LI" && views[i].id != view + 'Link') {					if(views[i].className != 'popup_nav_right')						views[i].className = '';				} else {					views[i].className = 'selected';				}			}		}	},	switchSecondView: function(parent,view) {		popup.switchView(parent);		var views = document.getElementById(parent).childNodes;		for(var i = 0; i < views.length; i++ ) {			if(views[i].nodeType == 1) {				if(views[i].nodeName == "DIV" && views[i].id != view) {					views[i].style.display = 'none';				} else {					views[i].style.display = 'block';				}			}		}		var views = document.getElementById(parent + "_nav").childNodes;		for(var i = 0; i < views.length; i++ ) {			if(views[i].nodeType == 1) {				if(views[i].nodeName == "LI" && views[i].id != view + 'Link') {					if(views[i].className != 'popup_nav_right')						views[i].className = '';				} else {					views[i].className = 'selected';				}			}		}	},	deezerControl: function(action,options) {		popup.action = action;		if(typeof options === "undefined")			var options = {};		chrome.windows.getAll({populate : true},function(windows) {			for(var i = 0; i < windows.length; i++) {				var j = 0;				for(var dumb in windows[i].tabs) {					chrome.tabs.sendRequest(windows[i].tabs[j].id, {name: "controlDeezer", action: popup.action, options: options}, function(response) { return true; });					j++;				}			}		});		switch(popup.action) {			case "pause":				document.getElementById("controlPause").style.display = 'none';				document.getElementById("controlPlay").style.display = '';				popup.playPauseChanged = true;			break;			case "play":				document.getElementById("controlPause").style.display = '';				document.getElementById("controlPlay").style.display = 'none';				popup.playPauseChanged = 2;			break;		}	}}